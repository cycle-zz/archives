<html>
	<head>
		<title>SPARK: Stream Processing Abstraction and Rendering Toolkit</title>
		<link HREF="style.css" REL="stylesheet" TYPE="text/css">
	</head>
	<body>
		<div width="100%" height="40px" class="banner">
			Spark API Documentation
		</div>
<!-- Generated by Doxygen 1.3.8 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>SpRandom.cpp</h1><a href="SpRandom_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="preprocessor">#include "<a class="code" href="SpRandom_8h.html">SpRandom.h</a>"</span>
00002 
00003 <span class="comment">//----------------------------------------------------------------------------</span>
00004 
00005 <span class="keyword">using</span> <span class="keyword">namespace </span>Spark;
00006 
00007 <span class="comment">// -----------------------------------------------------------------------------</span>
00008 <span class="comment">/*</span>
00009 <span class="comment">   Copyright (C) 1997 - 2002, Makoto Matsumoto and Takuji Nishimura,</span>
00010 <span class="comment">   All rights reserved.</span>
00011 <span class="comment"></span>
00012 <span class="comment">   Redistribution and use in source and binary forms, with or without</span>
00013 <span class="comment">   modification, are permitted provided that the following conditions</span>
00014 <span class="comment">   are met:</span>
00015 <span class="comment"></span>
00016 <span class="comment">     1. Redistributions of source code must retain the above copyright</span>
00017 <span class="comment">        notice, this list of conditions and the following disclaimer.</span>
00018 <span class="comment"></span>
00019 <span class="comment">     2. Redistributions in binary form must reproduce the above copyright</span>
00020 <span class="comment">        notice, this list of conditions and the following disclaimer in the</span>
00021 <span class="comment">        documentation and/or other materials provided with the distribution.</span>
00022 <span class="comment"></span>
00023 <span class="comment">     3. The names of its contributors may not be used to endorse or promote</span>
00024 <span class="comment">        products derived from this software without specific prior written</span>
00025 <span class="comment">        permission.</span>
00026 <span class="comment"></span>
00027 <span class="comment">   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
00028 <span class="comment">   "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
00029 <span class="comment">   LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
00030 <span class="comment">   A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR</span>
00031 <span class="comment">   CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,</span>
00032 <span class="comment">   EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,</span>
00033 <span class="comment">   PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR</span>
00034 <span class="comment">   PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF</span>
00035 <span class="comment">   LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING</span>
00036 <span class="comment">   NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span>
00037 <span class="comment">   SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
00038 <span class="comment">*/</span>
00039 <span class="comment">// -----------------------------------------------------------------------------</span>
00040 
<a name="l00041"></a><a class="code" href="SpRandom_8cpp.html#a0">00041</a> <span class="preprocessor">#define N 624</span>
<a name="l00042"></a><a class="code" href="SpRandom_8cpp.html#a1">00042</a> <span class="preprocessor"></span><span class="preprocessor">#define M 397</span>
<a name="l00043"></a><a class="code" href="SpRandom_8cpp.html#a2">00043</a> <span class="preprocessor"></span><span class="preprocessor">#define MATRIX_A 0x9908b0dfUL   </span><span class="comment">/* constant vector a */</span>
<a name="l00044"></a><a class="code" href="SpRandom_8cpp.html#a3">00044</a> <span class="preprocessor">#define UPPER_MASK 0x80000000UL </span><span class="comment">/* most significant w-r bits */</span>
<a name="l00045"></a><a class="code" href="SpRandom_8cpp.html#a4">00045</a> <span class="preprocessor">#define LOWER_MASK 0x7fffffffUL </span><span class="comment">/* least significant r bits */</span>
00046 
00047 <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mt[<a class="code" href="SpRandom_8cpp.html#a0">N</a>]; <span class="comment">/* the array for the state vector  */</span>
00048 <span class="keyword">static</span> <span class="keywordtype">int</span> mti = <a class="code" href="SpRandom_8cpp.html#a0">N</a> + 1; <span class="comment">/* mti==N+1 means mt[N] is not initialized */</span>
00049 
00050 <span class="comment">// -----------------------------------------------------------------------------</span>
<a name="l00051"></a><a class="code" href="namespaceSpark.html#a112">00051</a> <span class="keywordtype">void</span> <a class="code" href="namespaceSpark.html#a112">Spark::SeedRandom</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> seed)
00052 {
00053     mt[0] = seed &amp; 0xffffffffUL;
00054     <span class="keywordflow">for</span> (mti = 1; mti &lt; <a class="code" href="SpRandom_8cpp.html#a0">N</a>; mti++)
00055     {
00056         mt[mti] =
00057             (1812433253UL * (mt[mti - 1] ^ (mt[mti - 1] &gt;&gt; 30)) + mti);
00058 
00059         <span class="comment">/* See Knuth TAOCP Vol2. 3rd Ed. P.106 for multiplier. */</span>
00060         <span class="comment">/* In the previous versions, MSBs of the seed affect   */</span>
00061         <span class="comment">/* only MSBs of the array mt[].                        */</span>
00062         <span class="comment">/* 2002/01/09 modified by Makoto Matsumoto             */</span>
00063         mt[mti] &amp;= 0xffffffffUL;
00064         <span class="comment">/* for &gt;32 bit machines */</span>
00065     }
00066 }
00067 <span class="comment">// -----------------------------------------------------------------------------</span>
00068 <span class="comment">/* generate a random 32bit unsigned int */</span>
00069 <span class="comment">// -----------------------------------------------------------------------------</span>
<a name="l00070"></a><a class="code" href="namespaceSpark.html#a113">00070</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="namespaceSpark.html#a113">Spark::RandomUInt</a>(<span class="keywordtype">void</span>)
00071 {
00072     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> y;
00073     <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mag01[2] = {0x0UL, <a class="code" href="SpRandom_8cpp.html#a2">MATRIX_A</a>};
00074     <span class="comment">/* mag01[x] = x * MATRIX_A  for x=0,1 */</span>
00075 
00076     <span class="keywordflow">if</span> (mti &gt;= <a class="code" href="SpRandom_8cpp.html#a0">N</a>)
00077     {
00078         <span class="comment">/* generate N words at one time */</span>
00079         <span class="keywordtype">int</span> kk;
00080 
00081         <span class="keywordflow">if</span> (mti == <a class="code" href="SpRandom_8cpp.html#a0">N</a> + 1)   <span class="comment">/* if init_genrand() has not been called, */</span>
00082             <a class="code" href="namespaceSpark.html#a112">SeedRandom</a>(5489UL); <span class="comment">/* default initial seed */</span>
00083 
00084         <span class="keywordflow">for</span> (kk = 0;kk &lt; <a class="code" href="SpRandom_8cpp.html#a0">N</a> - <a class="code" href="SpRandom_8cpp.html#a1">M</a>;kk++)
00085         {
00086             y = (mt[kk] &amp; <a class="code" href="SpRandom_8cpp.html#a3">UPPER_MASK</a>) | (mt[kk + 1] &amp; <a class="code" href="SpRandom_8cpp.html#a4">LOWER_MASK</a>);
00087             mt[kk] = mt[kk + <a class="code" href="SpRandom_8cpp.html#a1">M</a>] ^ (y &gt;&gt; 1) ^ mag01[y &amp; 0x1UL];
00088         }
00089         <span class="keywordflow">for</span> (;kk &lt; <a class="code" href="SpRandom_8cpp.html#a0">N</a> - 1;kk++)
00090         {
00091             y = (mt[kk] &amp; <a class="code" href="SpRandom_8cpp.html#a3">UPPER_MASK</a>) | (mt[kk + 1] &amp; <a class="code" href="SpRandom_8cpp.html#a4">LOWER_MASK</a>);
00092             mt[kk] = mt[kk + (<a class="code" href="SpRandom_8cpp.html#a1">M</a> - <a class="code" href="SpRandom_8cpp.html#a0">N</a>)] ^ (y &gt;&gt; 1) ^ mag01[y &amp; 0x1UL];
00093         }
00094         y = (mt[<a class="code" href="SpRandom_8cpp.html#a0">N</a> - 1] &amp; <a class="code" href="SpRandom_8cpp.html#a3">UPPER_MASK</a>) | (mt[0] &amp; <a class="code" href="SpRandom_8cpp.html#a4">LOWER_MASK</a>);
00095         mt[<a class="code" href="SpRandom_8cpp.html#a0">N</a> - 1] = mt[<a class="code" href="SpRandom_8cpp.html#a1">M</a> - 1] ^ (y &gt;&gt; 1) ^ mag01[y &amp; 0x1UL];
00096 
00097         mti = 0;
00098     }
00099 
00100     y = mt[mti++];
00101 
00102     <span class="comment">/* Tempering */</span>
00103     y ^= (y &gt;&gt; 11);
00104     y ^= (y &lt;&lt; 7) &amp; 0x9d2c5680UL;
00105     y ^= (y &lt;&lt; 15) &amp; 0xefc60000UL;
00106     y ^= (y &gt;&gt; 18);
00107 
00108     <span class="keywordflow">return</span> y;
00109 }
00110 <span class="comment">// -----------------------------------------------------------------------------</span>
00111 <span class="comment">/* generates a random real number on [0,1]-real-interval */</span>
<a name="l00112"></a><a class="code" href="namespaceSpark.html#a114">00112</a> <span class="keywordtype">float</span> <a class="code" href="namespaceSpark.html#a114">Spark::RandomUnitFloat</a>(<span class="keywordtype">void</span>)
00113 {
00114     <span class="keywordflow">return</span> <a class="code" href="namespaceSpark.html#a113">RandomUInt</a>()*((<span class="keywordtype">float</span>)1.0 / (<span class="keywordtype">float</span>)4294967295.0);
00115     <span class="comment">/* divided by 2^32-1 */</span>
00116 }
00117 <span class="comment">// -----------------------------------------------------------------------------</span>
00118 <span class="comment">/* generates a random real number on [0,1)-real-interval */</span>
<a name="l00119"></a><a class="code" href="namespaceSpark.html#a115">00119</a> <span class="keywordtype">float</span> <a class="code" href="namespaceSpark.html#a115">Spark::RandomUnitOpenFloat</a>(<span class="keywordtype">void</span>)
00120 {
00121     <span class="keywordflow">return</span> <a class="code" href="namespaceSpark.html#a113">RandomUInt</a>()*((<span class="keywordtype">float</span>)1.0 / (<span class="keywordtype">float</span>)4294967296.0);
00122     <span class="comment">/* divided by 2^32 */</span>
00123 }
00124 <span class="comment">// -----------------------------------------------------------------------------</span>
00125 
</div></pre>		<div class="footer" width="100%">
		<hr>
			<a href="http://lyon-smith.org/">&copy; Derek Gerstmann - NCCA - Bournemouth University - 2004</a>
		</div>
		<br>
	</body>
</html>
