<html>
	<head>
		<title>SPARK: Stream Processing Abstraction and Rendering Toolkit</title>
		<link HREF="style.css" REL="stylesheet" TYPE="text/css">
	</head>
	<body>
		<div width="100%" height="40px" class="banner">
			Spark API Documentation
		</div>
<!-- Generated by Doxygen 1.3.8 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>SpResourcePath.cpp</h1><a href="SpResourcePath_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="preprocessor">#include "<a class="code" href="SpResourcePath_8h.html">SpResourcePath.h</a>"</span>
00002 
00003 <span class="preprocessor">#ifdef WIN32</span>
00004 <span class="preprocessor"></span><span class="preprocessor">#include &lt;io.h&gt;</span>
00005 <span class="preprocessor">#else</span>
00006 <span class="preprocessor"></span><span class="preprocessor">#include &lt;sys/stat.h&gt;</span>
00007 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
00008 <span class="preprocessor">#endif</span>
00009 <span class="preprocessor"></span><span class="preprocessor">#include &lt;fcntl.h&gt;</span>
00010 <span class="comment">// ---------------------------------------------------------------------------</span>
00011 
00012 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00013 <span class="keyword">using</span> <span class="keyword">namespace </span>Spark;
00014 
00015 <span class="comment">// ---------------------------------------------------------------------------</span>
<a name="l00016"></a><a class="code" href="classSpark_1_1SpResourcePath.html#a7">00016</a> <a class="code" href="classSpark_1_1SpString.html">SpString</a> <a class="code" href="classSpark_1_1SpResourcePath.html#a7">SpResourcePath::getPath</a>(<span class="keyword">const</span> <a class="code" href="classSpark_1_1SpString.html">SpString</a>&amp; rkFilename)
00017 {
00018     FILE* pkFile;
00019     <span class="keywordtype">bool</span> bFound = <span class="keyword">false</span>;
00020     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i &lt; m_kSearchPath.size(); i++)
00021     {
00022         m_kPathName = m_kSearchPath[i] + <span class="stringliteral">"/"</span> + rkFilename;
00023         pkFile= ::fopen(m_kPathName.c_str(), <span class="stringliteral">"r"</span>);
00024 
00025         <span class="keywordflow">if</span>(pkFile!= 0)
00026         {
00027             fclose(pkFile);
00028             bFound = <span class="keyword">true</span>;
00029             <span class="keywordflow">break</span>;
00030         }
00031     }
00032 
00033     <span class="keywordflow">if</span> (bFound == <span class="keyword">false</span>)
00034     {
00035         m_kPathName = rkFilename;
00036         pkFile= ::fopen(m_kPathName.c_str(),<span class="stringliteral">"r"</span>);
00037         <span class="keywordflow">if</span> (pkFile!= 0)
00038         {
00039             fclose(pkFile);
00040             bFound = <span class="keyword">true</span>;
00041         }
00042     }
00043 
00044     <span class="keywordflow">if</span> (bFound == <span class="keyword">false</span>)
00045     {
00046         <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i &lt; m_kSearchPath.size(); i++)
00047         {
00048             <a class="code" href="classSpark_1_1SpString.html#w0">SpString::SizeType</a> kCurrent;
00049             <a class="code" href="classSpark_1_1SpString.html">SpString</a> kName = rkFilename;
00050             <span class="keywordflow">while</span> ((kCurrent = kName.find_first_of(<span class="stringliteral">"\\/"</span>)) != SpString::npos)
00051             {
00052                 kCurrent++;
00053 
00054                 kName = kName.substr(kCurrent, kName.length()-kCurrent);
00055                 m_kPathName = m_kSearchPath[i] + <span class="stringliteral">"/"</span> + kName;
00056                 pkFile= ::fopen(m_kPathName.c_str(), <span class="stringliteral">"r"</span>);
00057 
00058                 <span class="keywordflow">if</span>(pkFile!= 0)
00059                 {
00060                     fclose(pkFile);
00061                     bFound = <span class="keyword">true</span>;
00062                     <span class="keywordflow">break</span>;
00063                 }
00064             }
00065 
00066             <span class="keywordflow">if</span> (bFound) <span class="keywordflow">break</span>;
00067         }
00068     }
00069 
00070     <span class="keywordflow">if</span> (bFound == <span class="keyword">false</span>)
00071         <span class="keywordflow">return</span> <span class="stringliteral">""</span>;
00072 
00073     <a class="code" href="classSpark_1_1SpString.html#w0">SpString::SizeType</a> kIndex = m_kPathName.rfind(<span class="charliteral">'\\'</span>);
00074     <span class="keywordflow">if</span> (kIndex == -1)
00075     {
00076         kIndex = m_kPathName.rfind(<span class="charliteral">'/'</span>);
00077     }
00078 
00079     <span class="keywordflow">if</span> (kIndex != -1)
00080         m_kFilePath = m_kPathName.substr(0, kIndex);
00081     <span class="keywordflow">else</span>
00082         m_kFilePath = <span class="stringliteral">"."</span>;
00083     <span class="keywordflow">return</span> m_kFilePath;
00084 }
00085 <span class="comment">// ---------------------------------------------------------------------------</span>
<a name="l00086"></a><a class="code" href="classSpark_1_1SpResourcePath.html#a8">00086</a> <a class="code" href="classSpark_1_1SpString.html">SpString</a> <a class="code" href="classSpark_1_1SpResourcePath.html#a8">SpResourcePath::getFile</a>(<span class="keyword">const</span> <a class="code" href="classSpark_1_1SpString.html">SpString</a>&amp; rkFilename)
00087 {
00088     FILE* pkFile;
00089 
00090     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i &lt; m_kSearchPath.size(); i++)
00091     {
00092         m_kPathName = m_kSearchPath[i] + <span class="stringliteral">"/"</span> + rkFilename;
00093         pkFile= ::fopen(m_kPathName.c_str(), <span class="stringliteral">"r"</span>);
00094 
00095         <span class="keywordflow">if</span>(pkFile!= 0)
00096         {
00097             fclose(pkFile);
00098             <span class="keywordflow">return</span> m_kPathName;
00099         }
00100     }
00101 
00102     m_kPathName = rkFilename;
00103     pkFile= ::fopen(m_kPathName.c_str(),<span class="stringliteral">"r"</span>);
00104     <span class="keywordflow">if</span> (pkFile!= 0)
00105     {
00106         fclose(pkFile);
00107         <span class="keywordflow">return</span> m_kPathName;
00108     }
00109 
00110     <span class="keywordflow">for</span>(i=0; i &lt; m_kSearchPath.size(); i++)
00111     {
00112         <a class="code" href="classSpark_1_1SpString.html#w0">SpString::SizeType</a> kCurrent;
00113         <a class="code" href="classSpark_1_1SpString.html">SpString</a> kName = rkFilename;
00114         <span class="keywordflow">while</span> ((kCurrent = kName.find_first_of(<span class="stringliteral">"\\/"</span>)) != SpString::npos)
00115         {
00116             kCurrent++;
00117 
00118             kName = kName.substr(kCurrent, kName.length()-kCurrent);
00119             m_kPathName = m_kSearchPath[i] + <span class="stringliteral">"/"</span> + kName;
00120             pkFile= ::fopen(m_kPathName.c_str(), <span class="stringliteral">"r"</span>);
00121 
00122             <span class="keywordflow">if</span>(pkFile!= 0)
00123             {
00124                 fclose(pkFile);
00125                 <span class="keywordflow">return</span> m_kPathName;
00126             }
00127         }
00128     }
00129 
00130     printf(<span class="stringliteral">"File not found: %s\n"</span> ,rkFilename.c_str());
00131 
00132     <span class="keywordflow">return</span> <span class="stringliteral">""</span>;
00133 }
00134 <span class="comment">// ---------------------------------------------------------------------------</span>
<a name="l00135"></a><a class="code" href="classSpark_1_1SpResourcePath.html#a11">00135</a> FILE * <a class="code" href="classSpark_1_1SpResourcePath.html#a11">SpResourcePath::loadDataFile</a>(
00136     <span class="keyword">const</span> <a class="code" href="classSpark_1_1SpString.html">SpString</a>&amp; rkFilename, <span class="keyword">const</span> <span class="keywordtype">char</span> * acMode)
00137 {
00138     FILE* pkFile= ::fopen(rkFilename.c_str(),acMode);
00139     <span class="keywordflow">if</span> (pkFile!= 0)
00140         <span class="keywordflow">return</span> pkFile;
00141 
00142     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i &lt; m_kSearchPath.size(); i++)
00143     {
00144         <a class="code" href="classSpark_1_1SpString.html">SpString</a> s = m_kSearchPath[i] + <span class="stringliteral">"/"</span> + rkFilename;
00145         FILE * pkFile= ::fopen(s.c_str(), acMode);
00146 
00147         <span class="keywordflow">if</span>(pkFile!= 0)
00148             <span class="keywordflow">return</span> pkFile;
00149 
00150         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(m_kSearchPath[i].c_str(),<span class="stringliteral">""</span>))
00151         {
00152             FILE* pkFile= ::fopen(rkFilename.c_str(),acMode);
00153             <span class="keywordflow">if</span> (pkFile!= 0)
00154                 <span class="keywordflow">return</span> pkFile;
00155         }
00156     }
00157     <span class="keywordflow">return</span> 0;
00158 }
00159 <span class="comment">// ---------------------------------------------------------------------------</span>
<a name="l00160"></a><a class="code" href="classSpark_1_1SpResourcePath.html#a9">00160</a> <span class="keywordtype">char</span>* <a class="code" href="classSpark_1_1SpResourcePath.html#a9">SpResourcePath::loadTextFile</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* acFilename)
00161 {
00162     <span class="keywordflow">if</span> (!acFilename)
00163         <span class="keywordflow">return</span> NULL;
00164 
00165     <a class="code" href="classSpark_1_1SpResourcePath.html#w0">FileStat</a> kFS;
00166 
00167     <span class="keywordflow">if</span> (<a class="code" href="classSpark_1_1SpResourcePath.html#a12">getFileStats</a>(acFilename, &amp;kFS))
00168     {
00169         <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> ulSize = kFS.st_size;
00170 
00171         <span class="keywordtype">char</span> * acBuffer = <span class="keyword">new</span> <span class="keywordtype">char</span>[ulSize+1];
00172 
00173         FILE *pkFile = 0;
00174         <span class="keywordflow">if</span> (!(pkFile = <a class="code" href="classSpark_1_1SpResourcePath.html#a11">loadDataFile</a>(acFilename, <span class="stringliteral">"r"</span>)))
00175         {
00176             fprintf(stderr,<span class="stringliteral">"Cannot open \"%s\" for read!\n"</span>, acFilename);
00177             <span class="keywordflow">return</span> 0;
00178         }
00179 
00180         <span class="keywordtype">int</span> iBytes;
00181         iBytes = (<span class="keywordtype">int</span>)fread(acBuffer, 1, ulSize, pkFile);
00182 
00183         acBuffer[iBytes] = 0;
00184 
00185         fclose(pkFile);
00186 
00187         <span class="keywordflow">return</span> acBuffer;
00188     }
00189     fprintf(stderr,<span class="stringliteral">"Cannot open file \"%s\" for stat read!\n"</span>, acFilename);
00190     <span class="keywordflow">return</span> NULL;
00191 }
00192 <span class="comment">// ---------------------------------------------------------------------------</span>
<a name="l00193"></a><a class="code" href="classSpark_1_1SpResourcePath.html#a10">00193</a> <a class="code" href="classSpark_1_1SpString.html">SpString</a> <a class="code" href="classSpark_1_1SpResourcePath.html#a9">SpResourcePath::loadTextFile</a>(<span class="keyword">const</span> <a class="code" href="classSpark_1_1SpString.html">SpString</a>&amp; rkFilename)
00194 {
00195     <a class="code" href="classSpark_1_1SpString.html">SpString</a> kResult;
00196 
00197     <span class="keywordtype">char</span>* acBuffer = <a class="code" href="classSpark_1_1SpResourcePath.html#a9">loadTextFile</a>(rkFilename.c_str());
00198 
00199     <span class="keywordflow">if</span>(acBuffer)
00200     {
00201         kResult = <a class="code" href="classSpark_1_1SpString.html">SpString</a>(acBuffer);
00202         <span class="keyword">delete</span>[] acBuffer;
00203     }
00204 
00205     <span class="keywordflow">return</span> kResult;
00206 }
00207 <span class="comment">// ---------------------------------------------------------------------------</span>
<a name="l00208"></a><a class="code" href="classSpark_1_1SpResourcePath.html#a12">00208</a> <span class="keywordtype">int</span> <a class="code" href="classSpark_1_1SpResourcePath.html#a12">SpResourcePath::getFileStats</a>(
00209     <span class="keyword">const</span> <a class="code" href="classSpark_1_1SpString.html">SpString</a>&amp; rkFilename, <a class="code" href="classSpark_1_1SpResourcePath.html#w0">FileStat</a>* pkStat)
00210 {
00211     <span class="keywordflow">if</span>(m_kSearchPath.size() &lt; 1)
00212         m_kSearchPath.push_back(<span class="stringliteral">"."</span>);
00213 
00214     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i &lt; m_kSearchPath.size(); i++)
00215     {
00216         <a class="code" href="classSpark_1_1SpString.html">SpString</a> kI = m_kSearchPath[i];
00217         <a class="code" href="classSpark_1_1SpString.html">SpString</a> kS = kI + <span class="stringliteral">"/"</span> + rkFilename;
00218 
00219 <span class="preprocessor">#ifdef WIN32</span>
00220 <span class="preprocessor"></span>        <span class="keywordtype">int</span> iFileHandle = ::_open(kS.c_str(), _O_RDONLY);
00221 <span class="preprocessor">#else</span>
00222 <span class="preprocessor"></span>        <span class="keywordtype">int</span> iFileHandle = ::open(kS.c_str(), O_RDONLY);
00223 <span class="preprocessor">#endif</span>
00224 <span class="preprocessor"></span>
00225         <span class="keywordflow">if</span>(iFileHandle &gt;= 0)
00226         {
00227 
00228 <span class="preprocessor">#ifdef WIN32</span>
00229 <span class="preprocessor"></span>            <span class="keywordtype">int</span> iResult = ::_fstat( iFileHandle, pkStat );
00230 <span class="preprocessor">#else</span>
00231 <span class="preprocessor"></span>            <span class="keywordtype">int</span> iResult = ::fstat (iFileHandle, pkStat);
00232 <span class="preprocessor">#endif</span>
00233 <span class="preprocessor"></span>
00234             <span class="keywordflow">if</span>( iResult != 0 )
00235             {
00236                 fprintf( stderr, <span class="stringliteral">"An fstat error occurred.\n"</span> );
00237                 <span class="keywordflow">return</span> 0;
00238             }
00239 
00240 <span class="preprocessor">#ifdef WIN32</span>
00241 <span class="preprocessor"></span>            ::_close( iFileHandle );
00242 <span class="preprocessor">#else</span>
00243 <span class="preprocessor"></span>            ::close (iFileHandle);
00244 <span class="preprocessor">#endif</span>
00245 <span class="preprocessor"></span>
00246             <span class="keywordflow">return</span> 1;
00247         }
00248     }
00249     <span class="keywordflow">return</span> 0;
00250 }
00251 <span class="comment">// ---------------------------------------------------------------------------</span>
</div></pre>		<div class="footer" width="100%">
		<hr>
			<a href="http://lyon-smith.org/">&copy; Derek Gerstmann - NCCA - Bournemouth University - 2004</a>
		</div>
		<br>
	</body>
</html>
