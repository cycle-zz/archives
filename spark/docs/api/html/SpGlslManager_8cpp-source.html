<html>
	<head>
		<title>SPARK: Stream Processing Abstraction and Rendering Toolkit</title>
		<link HREF="style.css" REL="stylesheet" TYPE="text/css">
	</head>
	<body>
		<div width="100%" height="40px" class="banner">
			Spark API Documentation
		</div>
<!-- Generated by Doxygen 1.3.8 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>SpGlslManager.cpp</h1><a href="SpGlslManager_8cpp.html">Go to the documentation of this file.</a><pre class="fragment"><div>00001 <span class="preprocessor">#include "<a class="code" href="SpGlHeaders_8h.html">SpGlHeaders.h</a>"</span>
00002 <span class="preprocessor">#include "<a class="code" href="SpGpuProgram_8h.html">SpGpuProgram.h</a>"</span>
00003 <span class="preprocessor">#include "<a class="code" href="SpGlslManager_8h.html">SpGlslManager.h</a>"</span>
00004 <span class="preprocessor">#include "SpSpGlslVertexProgram.h"</span>
00005 <span class="preprocessor">#include "<a class="code" href="SpGlslFragmentProgram_8h.html">SpGlslFragmentProgram.h</a>"</span>
00006 <span class="preprocessor">#include "<a class="code" href="SpResourcePath_8h.html">SpResourcePath.h</a>"</span>
00007 <span class="preprocessor">#include "<a class="code" href="SpString_8h.html">SpString.h</a>"</span>
00008 <span class="preprocessor">#include &lt;iostream&gt;</span>
00009 
00010 <span class="comment">//----------------------------------------------------------------------------</span>
00011 
00012 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00013 <span class="keyword">using</span> <span class="keyword">namespace </span>Spark;
00014 
00015 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00016"></a><a class="code" href="classSpark_1_1SpGlslManager.html#t0">00016</a> <a class="code" href="classSpark_1_1SpResourcePath.html">SpResourcePath</a> SpGlslManager::ms_kSpResourcePath;
<a name="l00017"></a><a class="code" href="classSpark_1_1SpGlslManager.html#t1">00017</a> <a class="code" href="classSpark_1_1SpGpuProgram.html">SpGpuProgram</a>* SpGlslManager::ms_apkCurrent[SpGpuProgram::GPU_PROGRAM_COUNT];
00018 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00019"></a><a class="code" href="classSpark_1_1SpGlslManager.html#a0">00019</a> <a class="code" href="classSpark_1_1SpGlslManager.html#a0">SpGlslManager::~SpGlslManager</a>()
00020 {
00021     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = 0; i &lt; SpGpuProgram::GPU_PROGRAM_COUNT; i++)
00022     {
00023         <span class="keywordflow">if</span>( <a class="code" href="classSpark_1_1SpGlslManager.html#t1">ms_apkCurrent</a>[i] != NULL )
00024         {
00025             <a class="code" href="classSpark_1_1SpGpuProgram.html">SpGpuProgram</a>* pkSpGpuProgram = <a class="code" href="classSpark_1_1SpGlslManager.html#t1">ms_apkCurrent</a>[i];
00026             <a class="code" href="classSpark_1_1SpGlslManager.html#e4">release</a>(pkSpGpuProgram);
00027             <span class="comment">//ms_apkCurrent[i] = NULL;</span>
00028         }
00029     }
00030 }
00031 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00032"></a><a class="code" href="classSpark_1_1SpGlslManager.html#e0">00032</a> <span class="keywordtype">bool</span> <a class="code" href="classSpark_1_1SpGlslManager.html#e0">SpGlslManager::compile</a>( <a class="code" href="classSpark_1_1SpGpuProgram.html">SpGpuProgram</a>* pkSpGpuProgram )
00033 {
00034     <span class="keywordflow">if</span>(!<a class="code" href="classSpark_1_1SpGlslManager.html#e5">isSupported</a>(pkSpGpuProgram))
00035         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00036 
00037     GLenum eType = 0;
00038 
00039     <span class="keywordflow">if</span>( pkSpGpuProgram-&gt;<a class="code" href="classSpark_1_1SpGpuProgram.html#a4">getType</a>() == SpGpuProgram::GPU_GLSL_FRAGMENT_PROGRAM )
00040         eType = GL_FRAGMENT_SHADER_ARB;
00041     <span class="keywordflow">else</span>
00042         eType = GL_VERTEX_SHADER_ARB;
00043 
00044     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uiHandle = 0;
00045     uiHandle = glCreateProgramObjectARB();
00046 
00047     GLhandleARB uiObject = glCreateShaderObjectARB(eType);
00048     GLint iLength = (GLint)pkSpGpuProgram-&gt;<a class="code" href="classSpark_1_1SpGpuProgram.html#a3">getLength</a>();
00049 
00050     <span class="keyword">const</span> GLcharARB* aakSource = pkSpGpuProgram-&gt;<a class="code" href="classSpark_1_1SpGpuProgram.html#a1">getSource</a>();
00051     glShaderSourceARB(uiObject, 1, &amp;aakSource, &amp;iLength);
00052 
00053     <span class="comment">// compile shader object</span>
00054     glCompileShaderARB(uiObject);
00055 
00056     <span class="comment">// Check for errors and warnings...</span>
00057     GLint iCompiled = 0;
00058     glGetObjectParameterivARB(uiObject, GL_OBJECT_COMPILE_STATUS_ARB, &amp;iCompiled);
00059 
00060     <span class="comment">// Check for errors and warnings...</span>
00061     <span class="keywordflow">if</span> ( !iCompiled )
00062     {
00063         <span class="comment">// Find the error position</span>
00064         GLint iErrorPos;
00065         glGetIntegerv( GL_PROGRAM_ERROR_POSITION_ARB, &amp;iErrorPos );
00066 
00067         <span class="comment">// Print program errors and warnings string.</span>
00068         fprintf( stderr, <span class="stringliteral">"GLSL Compile Error at Position: %d\n"</span>,
00069             iErrorPos );
00070 
00071         <a class="code" href="classSpark_1_1SpGlslManager.html#e9">printInfoLog</a>( uiObject );
00072         <span class="comment">//fprintf( stderr, pkSpGpuProgram-&gt;getSource());</span>
00073         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00074     }
00075 
00076     <span class="comment">// attach vertex shader to program object</span>
00077     glAttachObjectARB(uiHandle, uiObject);
00078 
00079     <span class="comment">// delete vertex object, no longer needed</span>
00080     glDeleteObjectARB(uiObject);
00081 
00082     <span class="comment">// attempt to link the program</span>
00083     glLinkProgramARB(uiHandle);
00084 
00085     <span class="comment">// get the link status</span>
00086     GLint iLinkStatus = 0;
00087     glGetObjectParameterivARB(uiHandle, GL_OBJECT_LINK_STATUS_ARB, &amp;iLinkStatus);
00088 
00089     <span class="comment">// Check for errors and warnings...</span>
00090     <span class="keywordflow">if</span> (!iLinkStatus)
00091     {
00092         <span class="comment">// Find the error position</span>
00093         GLint iErrorPos;
00094         glGetIntegerv( GL_PROGRAM_ERROR_POSITION_ARB, &amp;iErrorPos );
00095 
00096         <span class="comment">// Print program errors and warnings string.</span>
00097         <span class="keyword">const</span> GLubyte *acErrorString;
00098         acErrorString = glGetString( GL_PROGRAM_ERROR_STRING_ARB );
00099         fprintf( stderr, <span class="stringliteral">"GLSL Linking Error at Position: %d\n%s\n"</span>,
00100             iErrorPos, acErrorString );
00101 
00102         <a class="code" href="classSpark_1_1SpGlslManager.html#e9">printInfoLog</a>( uiObject );
00103         <span class="comment">//fprintf( stderr, pkSpGpuProgram-&gt;getSource());</span>
00104         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00105     }
00106 
00107     <span class="comment">// assign the program handle to the program object</span>
00108     pkSpGpuProgram-&gt;<a class="code" href="classSpark_1_1SpGpuProgram.html#a5">setUserData</a>(&amp;uiHandle, <span class="keyword">sizeof</span>(GLuint));
00109     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00110 }
00111 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00112"></a><a class="code" href="classSpark_1_1SpGlslManager.html#e1">00112</a> <span class="keywordtype">bool</span> <a class="code" href="classSpark_1_1SpGlslManager.html#e1">SpGlslManager::bind</a>( <a class="code" href="classSpark_1_1SpGpuProgram.html">SpGpuProgram</a>* pkSpGpuProgram )
00113 {
00114     GLuint uiUserData;
00115 
00116     <span class="comment">// get the current id, if there is one</span>
00117     pkSpGpuProgram-&gt;<a class="code" href="classSpark_1_1SpGpuProgram.html#a6">getUserData</a>(&amp;uiUserData, <span class="keyword">sizeof</span>(GLuint));
00118     <span class="keywordflow">if</span> ( !uiUserData )
00119     {
00120         <span class="comment">// compile the shader to get a new id</span>
00121         <a class="code" href="classSpark_1_1SpGlslManager.html#e0">compile</a>(pkSpGpuProgram);
00122 
00123         <span class="comment">// get the updated id from the compile</span>
00124         pkSpGpuProgram-&gt;<a class="code" href="classSpark_1_1SpGpuProgram.html#a6">getUserData</a>(&amp;uiUserData, <span class="keyword">sizeof</span>(GLuint));
00125     }
00126 
00127     glUseProgramObjectARB(uiUserData);
00128     <a class="code" href="classSpark_1_1SpGlslManager.html#t1">ms_apkCurrent</a>[ pkSpGpuProgram-&gt;<a class="code" href="classSpark_1_1SpGpuProgram.html#a4">getType</a>() ] = pkSpGpuProgram;
00129     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00130 }
00131 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00132"></a><a class="code" href="classSpark_1_1SpGlslManager.html#e2">00132</a> <span class="keywordtype">bool</span> <a class="code" href="classSpark_1_1SpGlslManager.html#e2">SpGlslManager::enable</a>( <a class="code" href="classSpark_1_1SpGpuProgram.html">SpGpuProgram</a>* pkSpGpuProgram )
00133 {
00134     GLuint uiUserData;
00135 
00136     <span class="comment">// get the current id, if there is one</span>
00137     pkSpGpuProgram-&gt;<a class="code" href="classSpark_1_1SpGpuProgram.html#a6">getUserData</a>(&amp;uiUserData, <span class="keyword">sizeof</span>(GLuint));
00138     <span class="keywordflow">if</span> ( !uiUserData )
00139     {
00140         <span class="comment">// compile the shader to get a new id</span>
00141         <a class="code" href="classSpark_1_1SpGlslManager.html#e0">compile</a>(pkSpGpuProgram);
00142 
00143         <span class="comment">// get the updated id from the compile</span>
00144         pkSpGpuProgram-&gt;<a class="code" href="classSpark_1_1SpGpuProgram.html#a6">getUserData</a>(&amp;uiUserData, <span class="keyword">sizeof</span>(GLuint));
00145     }
00146 
00147     glUseProgramObjectARB(uiUserData);
00148     <a class="code" href="classSpark_1_1SpGlslManager.html#t1">ms_apkCurrent</a>[ pkSpGpuProgram-&gt;<a class="code" href="classSpark_1_1SpGpuProgram.html#a4">getType</a>() ] = pkSpGpuProgram;
00149     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00150 }
00151 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00152"></a><a class="code" href="classSpark_1_1SpGlslManager.html#e3">00152</a> <span class="keywordtype">bool</span> <a class="code" href="classSpark_1_1SpGlslManager.html#e3">SpGlslManager::disable</a>( <a class="code" href="classSpark_1_1SpGpuProgram.html">SpGpuProgram</a>* pkSpGpuProgram )
00153 {
00154     glUseProgramObjectARB(0);
00155     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00156 }
00157 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00158"></a><a class="code" href="classSpark_1_1SpGlslManager.html#e4">00158</a> <span class="keywordtype">bool</span> <a class="code" href="classSpark_1_1SpGlslManager.html#e4">SpGlslManager::release</a>( <a class="code" href="classSpark_1_1SpGpuProgram.html">SpGpuProgram</a>* pkSpGpuProgram )
00159 {
00160     GLuint uiUserData;
00161     pkSpGpuProgram-&gt;<a class="code" href="classSpark_1_1SpGpuProgram.html#a6">getUserData</a>(&amp;uiUserData, <span class="keyword">sizeof</span>(GLuint));
00162 
00163     <span class="keywordflow">if</span> ( uiUserData )
00164     {
00165         glDeleteProgramsARB(1,&amp;uiUserData);
00166         uiUserData = 0;
00167 
00168         pkSpGpuProgram-&gt;<a class="code" href="classSpark_1_1SpGpuProgram.html#a5">setUserData</a>(&amp;uiUserData, <span class="keyword">sizeof</span>(GLuint));
00169     }
00170 
00171     glUseProgramObjectARB(0);
00172 
00173     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00174 }
00175 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00176"></a><a class="code" href="classSpark_1_1SpGlslManager.html#e5">00176</a> <span class="keywordtype">bool</span> <a class="code" href="classSpark_1_1SpGlslManager.html#e5">SpGlslManager::isSupported</a>(<span class="keyword">const</span> <a class="code" href="classSpark_1_1SpGpuProgram.html">SpGpuProgram</a>* pkSpGpuProgram)
00177 {
00178     <span class="keyword">static</span> <span class="keywordtype">bool</span> bFirstTime = <span class="keyword">true</span>;
00179     <span class="keyword">static</span> <span class="keywordtype">bool</span> bSupported = <span class="keyword">true</span>;
00180 
00181     <span class="keywordflow">if</span>(bFirstTime)
00182     {
00183         <span class="keywordflow">if</span> (GL_TRUE != glewGetExtension(<span class="stringliteral">"GL_ARB_fragment_shader"</span>))
00184         {
00185             fprintf(stderr, <span class="stringliteral">"GLSL ERROR: GL_ARB_fragment_shader extension is not available!\n"</span>);
00186             bSupported = <span class="keyword">false</span>;
00187         }
00188 
00189         <span class="keywordflow">if</span> (GL_TRUE != glewGetExtension(<span class="stringliteral">"GL_ARB_vertex_shader"</span>))
00190         {
00191             fprintf(stderr, <span class="stringliteral">"GLSL ERROR: GL_ARB_vertex_shader extension is not available!\n"</span>);
00192             bSupported = <span class="keyword">false</span>;
00193         }
00194 
00195         <span class="keywordflow">if</span> (GL_TRUE != glewGetExtension(<span class="stringliteral">"GL_ARB_shader_objects"</span>))
00196         {
00197             fprintf(stderr, <span class="stringliteral">"GLSL ERROR: GL_ARB_shader_objects extension is not available!\n"</span>);
00198             bSupported = <span class="keyword">false</span>;
00199         }
00200 
00201         bFirstTime = <span class="keyword">false</span>;
00202     }
00203 
00204     <span class="keywordflow">if</span>( bSupported &amp;&amp;
00205         (pkSpGpuProgram-&gt;<a class="code" href="classSpark_1_1SpGpuProgram.html#a4">getType</a>() == SpGpuProgram::GPU_GLSL_VERTEX_PROGRAM ||
00206         pkSpGpuProgram-&gt;<a class="code" href="classSpark_1_1SpGpuProgram.html#a4">getType</a>() == SpGpuProgram::GPU_GLSL_FRAGMENT_PROGRAM ))
00207         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00208 
00209     <span class="keywordflow">return</span> <span class="keyword">false</span>;
00210 }
00211 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00212"></a><a class="code" href="classSpark_1_1SpGlslManager.html#e6">00212</a> <a class="code" href="classSpark_1_1SpGpuProgram.html">SpGpuProgram</a>* <a class="code" href="classSpark_1_1SpGlslManager.html#e6">SpGlslManager::loadFromFile</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* acFilename, SpGpuProgram::Type eType)
00213 {
00214     <span class="keywordflow">if</span>(eType == SpGpuProgram::GPU_GLSL_VERTEX_PROGRAM)
00215         <span class="keywordflow">return</span> (<a class="code" href="classSpark_1_1SpGpuProgram.html">SpGpuProgram</a>*)<a class="code" href="classSpark_1_1SpGlslManager.html#e7">loadVertexProgramFromFile</a>(acFilename);
00216 
00217     <span class="keywordflow">if</span>(eType == SpGpuProgram::GPU_GLSL_VERTEX_PROGRAM)
00218         <span class="keywordflow">return</span> (<a class="code" href="classSpark_1_1SpGpuProgram.html">SpGpuProgram</a>*)<a class="code" href="classSpark_1_1SpGlslManager.html#e8">loadFragmentProgramFromFile</a>(acFilename);
00219 
00220     <span class="keywordflow">return</span> NULL;
00221 }
00222 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00223"></a><a class="code" href="classSpark_1_1SpGlslManager.html#e7">00223</a> <a class="code" href="classSpark_1_1SpGlslVertexProgram.html">SpGlslVertexProgram</a>* <a class="code" href="classSpark_1_1SpGlslManager.html#e7">SpGlslManager::loadVertexProgramFromFile</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* acFilename)
00224 {
00225     <span class="keyword">const</span> <span class="keywordtype">char</span>* acSource = <a class="code" href="classSpark_1_1SpGlslManager.html#e10">SpGlslManager::searchpath</a>().<a class="code" href="classSpark_1_1SpResourcePath.html#a9">loadTextFile</a>( acFilename );
00226 
00227     <span class="keywordflow">if</span>(!acSource) <span class="keywordflow">return</span> NULL;
00228 
00229     <a class="code" href="classSpark_1_1SpGlslVertexProgram.html">SpGlslVertexProgram</a>* pkVP = <span class="keyword">new</span> <a class="code" href="classSpark_1_1SpGlslVertexProgram.html">SpGlslVertexProgram</a>(acSource);
00230     <span class="keyword">delete</span>[] acSource;
00231 
00232     <span class="keywordflow">return</span> pkVP;
00233 }
00234 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00235"></a><a class="code" href="classSpark_1_1SpGlslManager.html#e8">00235</a> <a class="code" href="classSpark_1_1SpGlslFragmentProgram.html">SpGlslFragmentProgram</a>* <a class="code" href="classSpark_1_1SpGlslManager.html#e8">SpGlslManager::loadFragmentProgramFromFile</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* acFilename)
00236 {
00237     <span class="keyword">const</span> <span class="keywordtype">char</span>* acSource = <a class="code" href="classSpark_1_1SpGlslManager.html#e10">SpGlslManager::searchpath</a>().<a class="code" href="classSpark_1_1SpResourcePath.html#a9">loadTextFile</a>( acFilename );
00238 
00239     <span class="keywordflow">if</span>(!acSource) <span class="keywordflow">return</span> NULL;
00240 
00241     <a class="code" href="classSpark_1_1SpGlslFragmentProgram.html">SpGlslFragmentProgram</a>* pkFP = <span class="keyword">new</span> <a class="code" href="classSpark_1_1SpGlslFragmentProgram.html">SpGlslFragmentProgram</a>(acSource);
00242     <span class="keyword">delete</span>[] acSource;
00243 
00244     <span class="keywordflow">return</span> pkFP;
00245 }
00246 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00247"></a><a class="code" href="classSpark_1_1SpGlslManager.html#e10">00247</a> <a class="code" href="classSpark_1_1SpResourcePath.html">SpResourcePath</a>&amp; <a class="code" href="classSpark_1_1SpGlslManager.html#e10">SpGlslManager::searchpath</a>()
00248 {
00249     <span class="keywordflow">return</span> <a class="code" href="classSpark_1_1SpGlslManager.html#t0">ms_kSpResourcePath</a>;
00250 }
00251 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00252"></a><a class="code" href="classSpark_1_1SpGlslManager.html#e9">00252</a> <span class="keywordtype">void</span> <a class="code" href="classSpark_1_1SpGlslManager.html#e9">SpGlslManager::printInfoLog</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uiHandle)
00253 {
00254     <span class="keywordtype">int</span> iMaxLength = 0;
00255     glGetObjectParameterivARB(uiHandle, GL_OBJECT_INFO_LOG_LENGTH_ARB, &amp;iMaxLength);
00256 
00257     <span class="keywordtype">char</span> *acInfoLog = <span class="keyword">new</span> <span class="keywordtype">char</span>[iMaxLength];
00258     glGetInfoLogARB(uiHandle, iMaxLength, &amp;iMaxLength, acInfoLog);
00259     fprintf(stderr, <span class="stringliteral">"GLSL InfoLog: \n%s"</span>, acInfoLog);
00260     <span class="keyword">delete</span>[] acInfoLog;
00261 }
00262 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00263"></a><a class="code" href="classSpark_1_1SpGlslManager.html#e11">00263</a> <span class="keywordtype">void</span> <a class="code" href="classSpark_1_1SpGlslManager.html#e11">SpGlslManager::enableTexturePassThrough</a>(<span class="keywordtype">bool</span> bRectangle)
00264 {
00265     <span class="keyword">static</span> <span class="keywordtype">bool</span> bLastRectangleOption = <span class="keyword">false</span>;
00266     <span class="keyword">static</span> <span class="keywordtype">bool</span> bInitialized = <span class="keyword">false</span>;
00267     <span class="keyword">static</span> GLuint iTextureProgram = 0;
00268 
00269     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* acTextureRectProgram =
00270         <span class="stringliteral">"!!ARBfp1.0\n"</span>
00271         <span class="stringliteral">"TEX result.color, fragment.texcoord[0], texture[0], RECT;\n"</span>
00272         <span class="stringliteral">"END\n"</span>;
00273 
00274     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* acTexture2dProgram =
00275         <span class="stringliteral">"!!ARBfp1.0\n"</span>
00276         <span class="stringliteral">"TEX result.color, fragment.texcoord[0], texture[0], 2D;\n"</span>
00277         <span class="stringliteral">"END\n"</span>;
00278 
00279     <span class="keywordflow">if</span>(!bInitialized || bLastRectangleOption != bRectangle)
00280     {
00281         glGenProgramsARB(1, &amp;iTextureProgram);
00282 
00283         <span class="keyword">const</span> <span class="keywordtype">char</span>* acTextureProgram = 0;
00284 
00285         <span class="keywordflow">if</span>(bRectangle)
00286             acTextureProgram = acTextureRectProgram;
00287         <span class="keywordflow">else</span>
00288             acTextureProgram = acTexture2dProgram;
00289 
00290         glBindProgramARB(GL_FRAGMENT_PROGRAM_ARB, iTextureProgram);
00291 
00292         glProgramStringARB(
00293             GL_FRAGMENT_PROGRAM_ARB,
00294             GL_PROGRAM_FORMAT_ASCII_ARB,
00295             (GLsizei)strlen(acTextureProgram),
00296             acTextureProgram
00297         );
00298 
00299         bLastRectangleOption = bRectangle;
00300         bInitialized = <span class="keyword">true</span>;
00301     }
00302 
00303     glBindProgramARB(GL_FRAGMENT_PROGRAM_ARB, iTextureProgram);
00304     glEnable(GL_FRAGMENT_PROGRAM_ARB);
00305     glActiveTexture(GL_TEXTURE0_ARB);
00306 }
00307 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00308"></a><a class="code" href="classSpark_1_1SpGlslManager.html#e12">00308</a> <span class="keywordtype">void</span> <a class="code" href="classSpark_1_1SpGlslManager.html#e12">SpGlslManager::enableFragmentPassThrough</a>()
00309 {
00310     <span class="keyword">static</span> <span class="keywordtype">bool</span> bInitialized = <span class="keyword">false</span>;
00311     <span class="keyword">static</span> GLuint iPassThroughProgram = 0;
00312 
00313     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* acPassThroughProgram =
00314         <span class="stringliteral">"!!ARBfp1.0\n"</span>
00315         <span class="stringliteral">"MOV result.color, fragment.color.primary;\n"</span>
00316         <span class="stringliteral">"END\n"</span>;
00317 
00318     <span class="keywordflow">if</span>(!bInitialized)
00319     {
00320         glGenProgramsARB(1, &amp;iPassThroughProgram);
00321 
00322         glBindProgramARB(GL_FRAGMENT_PROGRAM_ARB, iPassThroughProgram);
00323 
00324         glProgramStringARB(
00325             GL_FRAGMENT_PROGRAM_ARB,
00326             GL_PROGRAM_FORMAT_ASCII_ARB,
00327             (GLsizei)strlen(acPassThroughProgram),
00328             acPassThroughProgram
00329         );
00330 
00331         bInitialized = <span class="keyword">true</span>;
00332     }
00333 
00334     glBindProgramARB(GL_FRAGMENT_PROGRAM_ARB, iPassThroughProgram);
00335 }
00336 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00337"></a><a class="code" href="classSpark_1_1SpGlslManager.html#e13">00337</a> <span class="keywordtype">void</span> <a class="code" href="classSpark_1_1SpGlslManager.html#e13">SpGlslManager::enableFragmentPrograms</a>()
00338 {
00339     glEnable(GL_FRAGMENT_PROGRAM_ARB);
00340 }
00341 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00342"></a><a class="code" href="classSpark_1_1SpGlslManager.html#e14">00342</a> <span class="keywordtype">void</span> <a class="code" href="classSpark_1_1SpGlslManager.html#e14">SpGlslManager::enableVertexPrograms</a>()
00343 {
00344     glEnable(GL_VERTEX_PROGRAM_ARB);
00345 }
00346 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00347"></a><a class="code" href="classSpark_1_1SpGlslManager.html#e15">00347</a> <span class="keywordtype">void</span> <a class="code" href="classSpark_1_1SpGlslManager.html#e15">SpGlslManager::disableFragmentPrograms</a>()
00348 {
00349     glDisable(GL_FRAGMENT_PROGRAM_ARB);
00350 }
00351 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00352"></a><a class="code" href="classSpark_1_1SpGlslManager.html#e16">00352</a> <span class="keywordtype">void</span> <a class="code" href="classSpark_1_1SpGlslManager.html#e16">SpGlslManager::disableVertexPrograms</a>()
00353 {
00354     glDisable(GL_VERTEX_PROGRAM_ARB);
00355 }
</div></pre>		<div class="footer" width="100%">
		<hr>
			<a href="http://lyon-smith.org/">&copy; Derek Gerstmann - NCCA - Bournemouth University - 2004</a>
		</div>
		<br>
	</body>
</html>
