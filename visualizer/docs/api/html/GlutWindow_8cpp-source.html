<html>
	<head>
		<title>Branch - API Documentation</title>
		<link HREF="style.css" REL="stylesheet" TYPE="text/css">
	</head>
	<body>
		<div width="100%" height="40px" class="banner">
			Visualizer - API Documentation
		</div>
<!-- Generated by Doxygen 1.2.18 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>GlutWindow.cpp</h1><a href="GlutWindow_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="preprocessor">#include "<a class="code" href="DataTypes_8h.html">DataTypes.h</a>"</span>
00002 <span class="preprocessor">#include "<a class="code" href="Window_8h.html">Window.h</a>"</span>
00003 <span class="preprocessor">#include "<a class="code" href="GlutKeyBindings_8h.html">GlutKeyBindings.h</a>"</span>
00004 <span class="preprocessor">#include "<a class="code" href="GlutHeaders_8h.html">GlutHeaders.h</a>"</span>
00005 
00006 <span class="keyword">using</span> <span class="keyword">namespace </span>dg;
00007 
00008 <span class="keyword">static</span> <a class="code" href="namespacedg.html#a15">UInt</a> gs_uiGLUTModifiers = 0;
00009 <span class="comment">//----------------------------------------------------------------------------</span>
00010 <span class="keyword">static</span> <span class="keywordtype">void</span> ReshapeCallback(<span class="keywordtype">int</span> iWidth, <span class="keywordtype">int</span> iHeight)
00011 {
00012         Window* pkWindow = Window::current();
00013         <span class="keywordflow">if</span> ( pkWindow )
00014                 pkWindow-&gt;onReshape(iWidth, iHeight);
00015 }
00016 <span class="comment">//----------------------------------------------------------------------------</span>
00017 <span class="keyword">static</span> <span class="keywordtype">void</span> DisplayCallback()
00018 {
00019         Window* pkWindow = Window::current();
00020         <span class="keywordflow">if</span> ( pkWindow )
00021                 pkWindow-&gt;onDisplay();
00022 }
00023 <span class="comment">//----------------------------------------------------------------------------</span>
00024 <span class="keyword">static</span> <span class="keywordtype">void</span> IdleCallback()
00025 {
00026         Window* pkWindow = Window::current();
00027         <span class="keywordflow">if</span> ( pkWindow )
00028                 pkWindow-&gt;onIdle();
00029 }
00030 <span class="comment">//----------------------------------------------------------------------------</span>
00031 <span class="keyword">static</span> <span class="keywordtype">void</span> UpdateCallback( <a class="code" href="namespacedg.html#a14">Int</a> iValue )
00032 {
00033         Window* pkWindow = Window::current();
00034         <span class="keywordflow">if</span> ( pkWindow )
00035                 pkWindow-&gt;onUpdate( iValue );
00036 }
00037 <span class="comment">//----------------------------------------------------------------------------</span>
00038 <span class="keyword">static</span> <span class="keywordtype">void</span> KeyDownCallback(<a class="code" href="namespacedg.html#a11">UChar</a> ucKey, <a class="code" href="namespacedg.html#a14">Int</a> iX, <a class="code" href="namespacedg.html#a14">Int</a> iY)
00039 {
00040         Window* pkWindow = Window::current();
00041         <span class="keywordflow">if</span> ( pkWindow )
00042                 pkWindow-&gt;onKeyDown(ucKey, iX, iY);
00043 }
00044 <span class="comment">//----------------------------------------------------------------------------</span>
00045 <span class="keyword">static</span> <span class="keywordtype">void</span> KeyUpCallback(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> ucKey, <span class="keywordtype">int</span> iX, <span class="keywordtype">int</span> iY)
00046 {
00047         Window* pkWindow = Window::current();
00048         <span class="keywordflow">if</span> ( pkWindow )
00049                 pkWindow-&gt;onKeyUp(ucKey, iX, iY);
00050 }
00051 <span class="comment">//----------------------------------------------------------------------------</span>
00052 <span class="keyword">static</span> <span class="keywordtype">void</span> SpecialKeyDownCallback(<span class="keywordtype">int</span> iKey, <span class="keywordtype">int</span> iX, <span class="keywordtype">int</span> iY)
00053 {
00054         Window* pkWindow = Window::current();
00055         <span class="keywordflow">if</span> ( pkWindow )
00056                 pkWindow-&gt;onSpecialKeyDown(iKey, iX, iY);
00057 }
00058 <span class="comment">//----------------------------------------------------------------------------</span>
00059 <span class="keyword">static</span> <span class="keywordtype">void</span> SpecialKeyUpCallback(<span class="keywordtype">int</span> iKey, <span class="keywordtype">int</span> iX, <span class="keywordtype">int</span> iY)
00060 {
00061         Window* pkWindow = Window::current();
00062         <span class="keywordflow">if</span> ( pkWindow )
00063                 pkWindow-&gt;onSpecialKeyUp(iKey, iX, iY);
00064 }
00065 <span class="comment">//----------------------------------------------------------------------------</span>
00066 <span class="keyword">static</span> <span class="keywordtype">void</span> MouseClickCallback(<span class="keywordtype">int</span> iButton, <span class="keywordtype">int</span> iState, <span class="keywordtype">int</span> iX, <span class="keywordtype">int</span> iY)
00067 {
00068         Window* pkWindow = Window::current();
00069         <span class="keywordflow">if</span> ( pkWindow )
00070         {
00071                 <span class="keywordtype">int</span> iModifiers = glutGetModifiers();
00072                 gs_uiGLUTModifiers = *(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>*) &amp; iModifiers;
00073                 pkWindow-&gt;onMouseClick(iButton, iState, iX, iY, gs_uiGLUTModifiers);
00074         }
00075 }
00076 <span class="comment">//----------------------------------------------------------------------------</span>
00077 <span class="keyword">static</span> <span class="keywordtype">void</span> MotionCallback(<span class="keywordtype">int</span> iX, <span class="keywordtype">int</span> iY)
00078 {
00079         Window* pkWindow = Window::current();
00080         <span class="keywordflow">if</span> ( pkWindow )
00081                 pkWindow-&gt;onMouseMotion(iX, iY, gs_uiGLUTModifiers);
00082 }
00083 <span class="comment">//----------------------------------------------------------------------------</span>
00084 <span class="keyword">static</span> <span class="keywordtype">void</span> PassiveMotionCallback(<span class="keywordtype">int</span> iX, <span class="keywordtype">int</span> iY)
00085 {
00086         Window* pkWindow = Window::current();
00087         <span class="keywordflow">if</span> ( pkWindow )
00088                 pkWindow-&gt;onPassiveMotion(iX, iY);
00089 }
00090 <span class="comment">//----------------------------------------------------------------------------</span>
00091 <span class="keyword">static</span> <span class="keywordtype">void</span> Terminate()
00092 {
00093         Window* pkWindow = Window::current();
00094         <span class="keywordflow">if</span> ( pkWindow )
00095         {
00096                 pkWindow-&gt;onTerminate();
00097                 glutDestroyWindow(pkWindow-&gt;id());
00098         }
00099 }
00100 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00101"></a><a class="code" href="classdg_1_1Window.html#a3">00101</a> <span class="keywordtype">void</span> Window::onTerminate()
00102 {
00103         <span class="comment">//Terminate();</span>
00104         <span class="comment">//exit(0);</span>
00105 }
00106 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00107"></a><a class="code" href="classdg_1_1Window.html#a6">00107</a> <span class="keywordtype">void</span> Window::onUpdate( <a class="code" href="namespacedg.html#a14">Int</a> iValue )
00108 {
00109         <a class="code" href="classdg_1_1Window.html#a8">postRedisplay</a>();
00110         
00111         <span class="keywordflow">if</span>( iValue &gt; 0 )
00112                 glutTimerFunc( 60, UpdateCallback, 1 );
00113 }
00114 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00115"></a><a class="code" href="classdg_1_1Window.html#a23">00115</a> <span class="keywordtype">void</span> Window::makeCurrent()
00116 {
00117         <a class="code" href="classdg_1_1Window.html#q0">ms_pkWindow</a> = <span class="keyword">this</span>;
00118         glutSetWindow( <a class="code" href="classdg_1_1Window.html#a32">id</a>() );
00119 }
00120 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00121"></a><a class="code" href="classdg_1_1Window.html#a8">00121</a> <span class="keywordtype">void</span> Window::postRedisplay()
00122 {
00123         glutPostWindowRedisplay( <a class="code" href="classdg_1_1Window.html#a32">id</a>() );
00124 }
00125 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00126"></a><a class="code" href="classdg_1_1Window.html#a9">00126</a> <span class="keywordtype">void</span> Window::swapBuffers()
00127 {
00128         glutSwapBuffers();
00129 }
00130 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00131"></a><a class="code" href="classdg_1_1Window.html#a20">00131</a> <span class="keywordtype">void</span> Window::drawString(<span class="keyword">const</span> <a class="code" href="namespacedg.html#a10">Char</a>* pcString, <a class="code" href="namespacedg.html#a14">Int</a> iX, <a class="code" href="namespacedg.html#a14">Int</a> iY, <span class="keyword">const</span> <a class="code" href="classdg_1_1Color.html">Color</a>&amp; rkColor)
00132 {
00133         <a class="code" href="namespacedg.html#a15">UInt</a> uiLen, i;
00134         glPushAttrib(GL_LIGHTING_BIT);
00135         glDisable(GL_LIGHTING);
00136         
00137         glRasterPos2f(iX, iY);
00138         glColor4f( rkColor.<a class="code" href="classdg_1_1Color.html#a3">r</a>(), rkColor.<a class="code" href="classdg_1_1Color.html#a4">g</a>(), rkColor.<a class="code" href="classdg_1_1Color.html#a5">b</a>(), rkColor.<a class="code" href="classdg_1_1Color.html#a6">a</a>() );
00139         uiLen = (UInt) strlen(pcString);
00140         <span class="keywordflow">for</span> (i = 0; i &lt; uiLen; i++)
00141         {
00142                 glutBitmapCharacter(GLUT_BITMAP_HELVETICA_10, pcString[i]);
00143         }
00144         glPopAttrib();
00145 }
00146 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00147"></a><a class="code" href="classdg_1_1Window.html#a18">00147</a> <span class="keywordtype">void</span> Window::drawImage(
00148         <span class="keyword">const</span> <a class="code" href="namespacedg.html#a11">UChar</a>* aucBuffer, <a class="code" href="namespacedg.html#a15">UInt</a> uiPosX, <a class="code" href="namespacedg.html#a15">UInt</a> uiPosY,
00149         <a class="code" href="namespacedg.html#a15">UInt</a> uiWidth, <a class="code" href="namespacedg.html#a15">UInt</a> uiHeight, <span class="keywordtype">bool</span> bAlpha)
00150 {
00151     <span class="keywordflow">if</span> ( !aucBuffer )
00152         <span class="keywordflow">return</span>;
00153 
00154     <span class="comment">// disable everything that isnt needed for drawing the image</span>
00155     GLboolean bDepthTest = glIsEnabled(GL_DEPTH_TEST);
00156     GLboolean bLighting = glIsEnabled(GL_LIGHTING);
00157     GLboolean bTexture2D = glIsEnabled(GL_TEXTURE_2D);
00158     <span class="keywordflow">if</span> ( bDepthTest )
00159         glDisable(GL_DEPTH_TEST);
00160     <span class="keywordflow">if</span> ( bLighting )
00161         glDisable(GL_LIGHTING);
00162     <span class="keywordflow">if</span> ( bTexture2D )
00163         glDisable(GL_TEXTURE_2D);
00164 
00165         <span class="comment">// clear out the model and projection matrices</span>
00166     glMatrixMode(GL_MODELVIEW);
00167     glPushMatrix();
00168     glLoadIdentity();
00169     glMatrixMode(GL_PROJECTION);
00170     glPushMatrix();
00171     glLoadIdentity();
00172         
00173         <span class="comment">// create an ortho projection </span>
00174     glOrtho(0.0,(<span class="keywordtype">double</span>)<a class="code" href="classdg_1_1Window.html#n14">m_iWidth</a>,0.0,(<span class="keywordtype">double</span>)<a class="code" href="classdg_1_1Window.html#n15">m_iHeight</a>,0.0,1.0);
00175 
00176         <span class="comment">// set the raster position</span>
00177         glRasterPos3f(uiPosX, uiPosY, 0.0f);
00178 
00179         <span class="comment">// draw a blank image to correct for strange screen glitches</span>
00180     GLubyte aucBitmap[1] = {0};
00181     glBitmap(0,0,0.0f,0.0f,0.0f,(<span class="keywordtype">float</span>)<a class="code" href="classdg_1_1Window.html#n15">m_iHeight</a>,aucBitmap);
00182     glPopMatrix();
00183     glMatrixMode(GL_MODELVIEW);
00184     glPopMatrix();
00185 
00186         <span class="comment">// flip the image to account for opengl's origin being at bottom left</span>
00187     glPixelZoom(1.0f,-1.0f);
00188         
00189         <span class="comment">// draw the image</span>
00190         <span class="keywordflow">if</span>(bAlpha)
00191                 glDrawPixels((GLint)uiWidth,(GLint)uiHeight,GL_RGBA, GL_UNSIGNED_BYTE,
00192                 (<span class="keyword">const</span> GLvoid*)aucBuffer);
00193         <span class="keywordflow">else</span>
00194                 glDrawPixels((GLint)uiWidth,(GLint)uiHeight,GL_RGB, GL_UNSIGNED_BYTE,
00195                 (<span class="keyword">const</span> GLvoid*)aucBuffer);
00196                         
00197         <span class="comment">// reset the pixel zoom</span>
00198     glPixelZoom(1.0f,1.0f);
00199 
00200     <span class="comment">// reenable states</span>
00201     <span class="keywordflow">if</span> ( bDepthTest )
00202         glEnable(GL_DEPTH_TEST);
00203     <span class="keywordflow">if</span> ( bLighting )
00204         glEnable(GL_LIGHTING);
00205     <span class="keywordflow">if</span> ( bTexture2D )
00206         glEnable(GL_TEXTURE_2D);
00207 }
00208 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00209"></a><a class="code" href="classdg_1_1Window.html#a19">00209</a> <span class="keywordtype">void</span> Window::drawImage(
00210         <span class="keyword">const</span> <a class="code" href="namespacedg.html#a28">Real</a>* afBuffer, <a class="code" href="namespacedg.html#a15">UInt</a> uiPosX, <a class="code" href="namespacedg.html#a15">UInt</a> uiPosY,
00211         <a class="code" href="namespacedg.html#a15">UInt</a> uiWidth, <a class="code" href="namespacedg.html#a15">UInt</a> uiHeight, <span class="keywordtype">bool</span> bAlpha)
00212 {
00213     <span class="keywordflow">if</span> ( !afBuffer )
00214         <span class="keywordflow">return</span>;
00215 
00216     <span class="comment">// disable everything that isnt needed for drawing the image</span>
00217     GLboolean bDepthTest = glIsEnabled(GL_DEPTH_TEST);
00218     GLboolean bLighting = glIsEnabled(GL_LIGHTING);
00219     GLboolean bTexture2D = glIsEnabled(GL_TEXTURE_2D);
00220     <span class="keywordflow">if</span> ( bDepthTest )
00221         glDisable(GL_DEPTH_TEST);
00222     <span class="keywordflow">if</span> ( bLighting )
00223         glDisable(GL_LIGHTING);
00224     <span class="keywordflow">if</span> ( bTexture2D )
00225         glDisable(GL_TEXTURE_2D);
00226 
00227         <span class="comment">// clear out the model and projection matrices</span>
00228     glMatrixMode(GL_MODELVIEW);
00229     glPushMatrix();
00230     glLoadIdentity();
00231     glMatrixMode(GL_PROJECTION);
00232     glPushMatrix();
00233     glLoadIdentity();
00234         
00235         <span class="comment">// create an ortho projection</span>
00236     glOrtho(0.0,(<span class="keywordtype">double</span>)<a class="code" href="classdg_1_1Window.html#n14">m_iWidth</a>,0.0,(<span class="keywordtype">double</span>)<a class="code" href="classdg_1_1Window.html#n15">m_iHeight</a>,0.0,1.0);
00237 
00238         <span class="comment">// set the raster position</span>
00239         glRasterPos3f(uiPosX, uiPosY, 0.0);
00240 
00241         <span class="comment">// draw a blank bitmap to correct for strange screen glitches</span>
00242     GLubyte aucBitmap[1] = {0};
00243     glBitmap(0,0,0.0f,0.0f,0.0f,(<span class="keywordtype">float</span>)<a class="code" href="classdg_1_1Window.html#n15">m_iHeight</a>,aucBitmap);
00244     glPopMatrix();
00245     glMatrixMode(GL_MODELVIEW);
00246     glPopMatrix();
00247 
00248         <span class="comment">// flip the image to account for opengl's origin being at bottom left</span>
00249     glPixelZoom(1.0f,-1.0f);
00250                 
00251         <span class="comment">// draw the image</span>
00252         <span class="keywordflow">if</span>(bAlpha)
00253                 glDrawPixels((GLint)uiWidth,(GLint)uiHeight,GL_RGBA, GL_FLOAT,
00254                 (<span class="keyword">const</span> GLvoid*)afBuffer);
00255         <span class="keywordflow">else</span>
00256                 glDrawPixels((GLint)uiWidth,(GLint)uiHeight,GL_RGB, GL_FLOAT,
00257                 (<span class="keyword">const</span> GLvoid*)afBuffer);
00258                         
00259         <span class="comment">// reset the pixel zoom</span>
00260     glPixelZoom(1.0f,1.0f);
00261 
00262     <span class="comment">// reenable states</span>
00263     <span class="keywordflow">if</span> ( bDepthTest )
00264         glEnable(GL_DEPTH_TEST);
00265     <span class="keywordflow">if</span> ( bLighting )
00266         glEnable(GL_LIGHTING);
00267     <span class="keywordflow">if</span> ( bTexture2D )
00268         glEnable(GL_TEXTURE_2D);
00269 }
00270 <span class="comment">//----------------------------------------------------------------------------</span>
<a name="l00271"></a><a class="code" href="GlutWindow_8cpp.html#a13">00271</a> <span class="keywordtype">int</span> <a class="code" href="GlutWindow_8cpp.html#a13">main</a> (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv)
00272 {
00273         Window* pkWindow = Window::current();
00274         assert( pkWindow );
00275         <span class="keywordflow">if</span> ( !pkWindow )
00276                 <span class="keywordflow">return</span> -1;
00277 
00278         <span class="keywordflow">if</span> ( atexit(Terminate) != 0 )
00279                 <span class="keywordflow">return</span> -2;
00280 
00281         glutInit(&amp;argc, argv);
00282 
00283         <span class="keywordflow">if</span> ( !pkWindow-&gt;onStartup() )
00284                 <span class="keywordflow">return</span> -3;
00285 
00286         glutInitDisplayMode(GLUT_DOUBLE | GLUT_RGBA | GLUT_DEPTH | GLUT_STENCIL);
00287         glutInitWindowSize( pkWindow-&gt;width(), pkWindow-&gt;height() );
00288         pkWindow-&gt;setWindowID( glutCreateWindow(pkWindow-&gt;title()) );
00289 
00290         <span class="keywordflow">if</span> ( !pkWindow-&gt;onInitialize() )
00291                 <span class="keywordflow">return</span> -4;
00292         
00293         glutSetWindow( pkWindow-&gt;id() );
00294         glutReshapeFunc(ReshapeCallback);
00295         glutDisplayFunc(DisplayCallback);
00296         glutIdleFunc(IdleCallback);
00297         <span class="comment">//glutTimerFunc(60, UpdateCallback, 1);</span>
00298         glutKeyboardFunc(KeyDownCallback);
00299         glutKeyboardUpFunc(KeyUpCallback);
00300         glutSpecialFunc(SpecialKeyDownCallback);
00301         glutSpecialUpFunc(SpecialKeyUpCallback);
00302         glutMouseFunc(MouseClickCallback);
00303         glutMotionFunc(MotionCallback);
00304         glutPassiveMotionFunc(PassiveMotionCallback);           
00305         pkWindow-&gt;onDisplay();
00306         
00307         glutMainLoop();
00308         <span class="keywordflow">return</span> 0;
00309 }
00310 <span class="comment">//----------------------------------------------------------------------------</span>
00311 
00312 <span class="comment">//#endif</span>
00313 
</pre></div>		<div class="footer" width="100%">
		<hr>
			<a href="http://lyon-smith.org/">&copy; Derek Gerstmann - NCCA - Bournemouth University - 2004</a>
		</div>
		<br>
	</body>
</html>
