<html>
	<head>
		<title>Branch - API Documentation</title>
		<link HREF="style.css" REL="stylesheet" TYPE="text/css">
	</head>
	<body>
		<div width="100%" height="40px" class="banner">
			Visualizer - API Documentation
		</div>
<!-- Generated by Doxygen 1.2.18 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Camera.cpp</h1><a href="Camera_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="preprocessor">#include "<a class="code" href="Camera_8h.html">Camera.h</a>"</span>
00002 <span class="preprocessor">#include "<a class="code" href="Maths_8h.html">Maths.h</a>"</span>
00003 <span class="preprocessor">#include &lt;memory&gt;</span>
00004 
00005 <span class="keyword">using</span> <span class="keyword">namespace </span>dg;
00006 <span class="comment">//******************************************************************************</span>
<a name="l00007"></a><a class="code" href="classdg_1_1Camera.html#a0">00007</a> Camera::Camera(<span class="keyword">const</span> <a class="code" href="classdg_1_1Vector.html">Vector</a>&amp; rkPos, <span class="keyword">const</span> <a class="code" href="classdg_1_1Vector.html">Vector</a>&amp; rkDir, 
00008         <span class="keyword">const</span> <a class="code" href="classdg_1_1Vector.html">Vector</a>&amp; rkUp, <span class="keyword">const</span> <a class="code" href="classdg_1_1Vector.html">Vector</a>&amp; rkRight, <a class="code" href="namespacedg.html#a28">Real</a> fNear, <a class="code" href="namespacedg.html#a28">Real</a> fFar, 
00009         <a class="code" href="namespacedg.html#a28">Real</a> fHalfWidth, <a class="code" href="namespacedg.html#a28">Real</a> fHalfHeight, <a class="code" href="classdg_1_1Image.html">Image</a>* pkImage)
00010     : m_kPosition(rkPos),
00011       m_kDirection(rkDir),
00012       m_kUp(rkUp),
00013       m_kRight(rkRight),
00014           m_fNear(fNear),
00015           m_fFar(fFar),
00016           m_fHalfWidth(fHalfWidth),
00017           m_fHalfHeight(fHalfHeight),
00018           m_fPixelWidth(0),
00019           m_fPixelHeight(0),
00020           m_pkImage(pkImage)
00021 {
00022         <span class="comment">// EMPTY!</span>
00023 }
00024 <span class="comment">//******************************************************************************</span>
<a name="l00025"></a><a class="code" href="classdg_1_1Camera.html#a1">00025</a> Camera::~Camera ()
00026 {
00027 
00028 }
00029 <span class="comment">//******************************************************************************</span>
<a name="l00030"></a><a class="code" href="classdg_1_1Camera.html#a17">00030</a> <span class="keywordtype">void</span> Camera::setHorizontalFov(<a class="code" href="namespacedg.html#a28">Real</a> fHorizFov)
00031 {
00032         m_fHalfHeight = 0.5 * <a class="code" href="namespacedg.html#a117">Tangent</a>( <a class="code" href="namespacedg.html#a88">Radians</a>( fHorizFov ) );
00033 }
00034 <span class="comment">//******************************************************************************</span>
<a name="l00035"></a><a class="code" href="classdg_1_1Camera.html#a18">00035</a> <span class="keyword">inline</span> <a class="code" href="namespacedg.html#a28">Real</a> Camera::getHorizontalFov()<span class="keyword"> const</span>
00036 <span class="keyword"></span>{
00037         <span class="keywordflow">return</span> <a class="code" href="namespacedg.html#a89">Degrees</a>( <a class="code" href="namespacedg.html#a113">ArcTangent</a>( m_fHalfWidth*(1.0/m_fNear)) );
00038 }
00039 <span class="comment">//******************************************************************************</span>
<a name="l00040"></a><a class="code" href="classdg_1_1Camera.html#a21">00040</a> <span class="keywordtype">void</span> Camera::setVerticalFov(<a class="code" href="namespacedg.html#a28">Real</a> fVertFov)
00041 {
00042         m_fHalfHeight = 0.5 * <a class="code" href="namespacedg.html#a117">Tangent</a>( <a class="code" href="namespacedg.html#a88">Radians</a>( fVertFov ) );
00043 }
00044 <span class="comment">//******************************************************************************</span>
<a name="l00045"></a><a class="code" href="classdg_1_1Camera.html#a22">00045</a> <span class="keyword">inline</span> <a class="code" href="namespacedg.html#a28">Real</a> Camera::getVerticalFov()<span class="keyword"> const</span>
00046 <span class="keyword"></span>{
00047         <span class="keywordflow">return</span> <a class="code" href="namespacedg.html#a89">Degrees</a>( <a class="code" href="namespacedg.html#a113">ArcTangent</a>( m_fHalfHeight*(1.0/m_fNear)) );
00048 }
00049 <span class="comment">//******************************************************************************</span>
<a name="l00050"></a><a class="code" href="classdg_1_1Camera.html#a25">00050</a> <a class="code" href="classdg_1_1Vector.html">Vector</a> Camera::getRayDir(<a class="code" href="namespacedg.html#a15">UInt</a> uiX, <a class="code" href="namespacedg.html#a15">UInt</a> uiY)<span class="keyword"> const</span>
00051 <span class="keyword"></span>{
00052 <span class="comment">/*      </span>
00053 <span class="comment">        static UInt uiLastX = 0;</span>
00054 <span class="comment">        static UInt uiLastY = 0;</span>
00055 <span class="comment">        static Real fLastFX = 0;</span>
00056 <span class="comment">        static Real fLastFY = 0;</span>
00057 <span class="comment">        </span>
00058 <span class="comment">        Real fX = 0;</span>
00059 <span class="comment">        if(uiLastX != 0 &amp;&amp; uiX == uiLastX)</span>
00060 <span class="comment">                fX = fLastFX;</span>
00061 <span class="comment">        else</span>
00062 <span class="comment">                fX = m_fHalfWidth * (-1.0f + m_fMultiplyX * uiX);</span>
00063 <span class="comment"></span>
00064 <span class="comment">        uiLastX = uiX;</span>
00065 <span class="comment">        fLastFX = fX;</span>
00066 <span class="comment">        </span>
00067 <span class="comment">        Real fY = 0;</span>
00068 <span class="comment">        if(uiLastY != 0 &amp;&amp; uiY == uiLastY)</span>
00069 <span class="comment">                fY = fLastFY;</span>
00070 <span class="comment">        else</span>
00071 <span class="comment">                fY = m_fHalfHeight * (-1.0f + m_fMultiplyY * uiY);</span>
00072 <span class="comment">        </span>
00073 <span class="comment">        uiLastY = uiY;</span>
00074 <span class="comment">        fLastFY = fY;</span>
00075 <span class="comment">        </span>
00076 <span class="comment">    // compute ray direction starting from near clip plane</span>
00077 <span class="comment">    Vector kRayDir = m_fNear * m_kDirection + fX * m_kRight + fY * m_kUp;</span>
00078 <span class="comment">        kRayDir.normalize();</span>
00079 <span class="comment"></span>
00080 <span class="comment">        return( kRayDir );</span>
00081 <span class="comment">*/</span>
00082         
00083         <a class="code" href="classdg_1_1Vector.html">Vector</a> kRayDir(
00084                 m_kStartRay.<a class="code" href="classdg_1_1Vector.html#a2">x</a>() + uiX * m_fPixelWidth * 
00085                         m_kRight.<a class="code" href="classdg_1_1Vector.html#a2">x</a>() + uiY * m_fPixelHeight * m_kUp.<a class="code" href="classdg_1_1Vector.html#a2">x</a>(),
00086                 m_kStartRay.<a class="code" href="classdg_1_1Vector.html#a3">y</a>() + uiX * m_fPixelWidth * 
00087                         m_kRight.<a class="code" href="classdg_1_1Vector.html#a3">y</a>() + uiY * m_fPixelHeight * m_kUp.<a class="code" href="classdg_1_1Vector.html#a3">y</a>(),
00088                 m_kStartRay.<a class="code" href="classdg_1_1Vector.html#a4">z</a>() + uiX * m_fPixelWidth * 
00089                         m_kRight.<a class="code" href="classdg_1_1Vector.html#a4">z</a>() + uiY * m_fPixelHeight * m_kUp.<a class="code" href="classdg_1_1Vector.html#a4">z</a>()
00090         );
00091 
00092         kRayDir.<a class="code" href="classdg_1_1Vector.html#a34">normalize</a>();
00093         <span class="keywordflow">return</span>( kRayDir );
00094 }
00095 <span class="comment">//******************************************************************************</span>
<a name="l00096"></a><a class="code" href="classdg_1_1Camera.html#a2">00096</a> <span class="keywordtype">void</span> Camera::setup()
00097 {
00098         <span class="keywordflow">if</span>(!m_pkImage)
00099                 <span class="keywordflow">return</span>;
00100         
00101         <a class="code" href="namespacedg.html#a28">Real</a> fImageWidth = m_pkImage-&gt;<a class="code" href="classdg_1_1Image.html#a8">width</a>();  
00102         <a class="code" href="namespacedg.html#a28">Real</a> fImageHeight = m_pkImage-&gt;<a class="code" href="classdg_1_1Image.html#a9">height</a>();
00103 
00104     m_fMultiplyX = 2.0 / (fImageWidth - 1.0f);
00105     m_fMultiplyY = 2.0 / (fImageHeight - 1.0f);
00106 
00107         m_fPixelWidth = 2.0 * m_fHalfWidth / fImageWidth;
00108         m_fPixelHeight = 2.0 * m_fHalfHeight / fImageHeight;
00109         
00110         m_kStartRay.<a class="code" href="classdg_1_1Vector.html#a2">x</a>() = m_kDirection.<a class="code" href="classdg_1_1Vector.html#a2">x</a>() -
00111                                           0.5 * fImageWidth * m_fPixelWidth * m_kRight.<a class="code" href="classdg_1_1Vector.html#a2">x</a>() -
00112                                           0.5 * fImageHeight * m_fPixelHeight * m_kUp.<a class="code" href="classdg_1_1Vector.html#a2">x</a>();
00113                                    
00114     m_kStartRay.<a class="code" href="classdg_1_1Vector.html#a3">y</a>() = m_kDirection.<a class="code" href="classdg_1_1Vector.html#a3">y</a>() - 
00115                       0.5 * fImageWidth * m_fPixelWidth * m_kRight.<a class="code" href="classdg_1_1Vector.html#a3">y</a>() -
00116                       0.5 * fImageHeight * m_fPixelHeight * m_kUp.<a class="code" href="classdg_1_1Vector.html#a3">y</a>();
00117 
00118         m_kStartRay.<a class="code" href="classdg_1_1Vector.html#a4">z</a>() = m_kDirection.<a class="code" href="classdg_1_1Vector.html#a4">z</a>() - 
00119                       0.5 * fImageWidth * m_fPixelWidth * m_kRight.<a class="code" href="classdg_1_1Vector.html#a4">z</a>() -
00120                       0.5 * fImageHeight * m_fPixelHeight * m_kUp.<a class="code" href="classdg_1_1Vector.html#a4">z</a>();
00121 
00122 <span class="comment">//       relates Noise() to Nyquist limit </span>
00123 <span class="comment">//      m_fSampleScale = -Log2(Tangent(DEGTORAD(0.5*camera-&gt;hfov / camera-&gt;hres))) - 3.0;       </span>
00124 
00125 }
00126 <span class="comment">//******************************************************************************</span>
00127 
</pre></div>		<div class="footer" width="100%">
		<hr>
			<a href="http://lyon-smith.org/">&copy; Derek Gerstmann - NCCA - Bournemouth University - 2004</a>
		</div>
		<br>
	</body>
</html>
